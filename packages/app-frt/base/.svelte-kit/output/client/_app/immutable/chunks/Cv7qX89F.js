import{d as i,w as d}from"./CWv1L7UP.js";function c(){const{subscribe:a,set:o,update:n}=d({user:null,loading:!0});return{subscribe:a,setUser:e=>{n(s=>({...s,user:e,loading:!1}))},setLoaded:()=>{n(e=>({...e,loading:!1}))},login:async(e,s)=>{n(t=>({...t,loading:!0}));try{const t=await fetch("/api/auth/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})});if(!t.ok){const u=await t.json().catch(()=>({message:"Login failed"}));throw new Error(u.message??"Login failed")}const r=await t.json();n(()=>({user:r.user,loading:!1}))}catch(t){throw n(r=>({...r,loading:!1})),t}},logout:async()=>{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),o({user:null,loading:!1})},refresh:async()=>{n(e=>({...e,loading:!0}));try{const e=await fetch("/api/auth/me",{credentials:"include"});if(!e.ok)return o({user:null,loading:!1}),null;const s=await e.json();return o({user:s,loading:!1}),s}catch{return o({user:null,loading:!1}),null}}}}const l=c(),f=i(l,a=>!!a.user);i(l,a=>a.user);const h=i(l,a=>a.loading);export{l as a,h as b,f as i};
